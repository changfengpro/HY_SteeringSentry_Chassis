# 最速控制综合函数----跟踪微分器(TD)


## 1. x1 和 x2：状态变量

**x1（输入/输出）**

- **作用**：跟踪目标值 v 的平滑轨迹（例如将阶跃信号转换为 S 型曲线）。
- **示例**：若目标值 v 是电机的阶跃转速（如 1000 RPM），x1 会逐渐从当前值平滑过渡到 1000 RPM。
- **数学意义**：表示系统对目标值的动态跟踪结果。

**x2（输入/输出）**

- **作用**：跟踪目标值的一阶微分（即 x1 的变化率，如转速的加速度）。
- **示例**：若 x1 在加速，x2 为正值；减速时则为负值。
- **数学意义**：表示跟踪过程的动态速率，用于预判系统未来状态。

---

## 2. v：目标输入值

- **类型**：输入参数
- **作用**：需要跟踪的原始目标值（如用户设定的阶跃指令）。
- **示例**：直接设定电机目标转速 v = 1000 RPM，但通过 TD 转换为平滑的 x1 轨迹。
- **重要性**：若不经过 TD 处理，直接使用 v 可能导致控制超调或机械冲击。

---

## 3. r：跟踪速度因子

- **类型**：输入参数
- **作用**：控制跟踪器的响应速度。值越大，跟踪越快（但可能引起超调）；值越小，跟踪越平缓。
- **数学关系**：在公式 `d = r * h0` 中，r 增大时，参数 d 增大，控制量 f 的计算会更激进。
- **调试建议**：
  - 初始值设为系统最大加速度的 2~3 倍（如电机最大加速度为 500 RPM/s，则 r 设为 1000~1500）。
  - 若系统出现超调，适当降低 r；若响应过慢，则增大 r。

---

## 4. h0：滤波因子

- **类型**：输入参数
- **作用**：抑制噪声对微分信号 x2 的影响。值越大，滤波效果越强（但跟踪延迟增加）。
- **数学关系**：与 r 共同决定参数 d，影响非线性跟踪的动态特性。
- **调试建议**：
  - 若传感器噪声较大（如编码器信号波动），增大 h0（典型值 0.01~0.1）。
  - 若需要快速响应（如伺服定位），减小 h0（可低至 0.001）。

---

## 5. h：积分步长

- **类型**：输入参数
- **作用**：状态更新的时间间隔，通常与控制系统采样周期一致。
- **示例**：若控制循环周期为 1 ms，则 h = 0.001。
- **数学意义**：在欧拉积分法中，`x1 += h * x2` 和 `x2 += h * f` 表示离散时间下的状态更新。
- **注意**：
  - h 必须与实际采样时间匹配，否则会导致计算误差或稳定性问题。
  - 若 h 设置过小（远小于实际周期），可能引发数值计算不稳定。

---

### 初始化参数（假设电机最大转速 2000 RPM，控制周期 1 ms）

```c
TD_s td = {
    .x1 = 0,      // 初始跟踪位置为0
    .x2 = 0,      // 初始微分速度为0
    .v = 1000,    // 目标转速1000 RPM
    .r = 800,     // 根据电机加速度调整
    .h0 = 0.005,  // 中等滤波强度
    .h = 0.001    // 匹配1ms控制周期
};
```

#### 调试步骤：

1. 观察 x1 是否平滑跟踪到 1000 RPM（无超调）。
2. 若 x1 上升过慢，增大 r；若出现振荡，减小 r 或增大 h0。
3. 若 x2 噪声明显，增大 h0。
